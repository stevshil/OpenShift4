#!/bin/bash

if (( $# < 1 ))
then
    echo "Please specify a time length in hours that the cluster will be down" 1>&2
    echo "SYNTAX: $0 10" 1>&2
    exit 1
fi

if echo "$1" | grep -v "^$1\$"
then
    echo "Please enter a number" 1>&2
    echo "SYNTAX: $0 10" 1>&2
    exit 2
fi

if [[ ! -e $HOME/openshift/install_dir/auth/kubeconfig ]]
then
    echo "There is no OpenShift configuration in $HOME/openshift/install_dir" 1>&2
    exit 3
else
    KUBECONFIG=$HOME/openshift/install_dir/auth/kubeconfig
    export KUBECONFIG
fi

for node in $(oc get nodes -o jsonpath='{.items[*].metadata.name}')
do 
    oc debug node/${node} -- chroot /host shutdown -h $1
done 